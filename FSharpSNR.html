<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Improve the signal, reduce the noise: bring F# to the table</title>
    <meta name="description" content="In object oriented programming world, writing code for the success of your project is often not enough. You have to bear in mind various frameworks and libraries like ORMs, IoC, mocking and testing and so on and so forth. Writing code is also complex: finding the right abstractions, or applying S.O.L.I.D principles and design patterns are meant to keep your code extensible and refactorable, but require the experience of a senior developer - and ultimately, they have little to do with delivering business value. This is just noise ! Signal-to-noise ratio is a measure used in science and engineering that compares the level of actual information conveyed by signal, to the level of background noise. We can see business value as signal, and noise as everything that is not directly used to deliver business value, like frameworks, libraries, complexity, lack of expressiveness. In this talk, we will explain how bringing F# to an actual project helped improve the signal and reduce the noise. The conciseness of F# helped de-clutter the code from useless language constructions. Its convenience made many programming tasks much simpler, and its very powerful type system prevented many common errors, and also helped expressing a really powerful domain model. Getting rid of mocking frameworks for testing, ORMs for databases, and using just functions, focusing on building functionality and delivering business value, made the whole experience a real pleasure !">
    <meta name="author" content="Tomasz JASKULA">
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script src="//code.jquery.com/jquery-1.8.0.js"></script>
    <script src="//code.jquery.com/ui/1.8.23/jquery-ui.js"></script>
    <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/css/bootstrap-combined.min.css" rel="stylesheet">
    <link rel="stylesheet" href="css/reveal.min.css">
    <link rel="stylesheet" href="css/theme/default.css" id="theme">
    <link type="text/css" rel="stylesheet" href="fsharp.formatting/styles/style.css" />
    <link type="text/css" rel="stylesheet" href="fsharp.formatting/styles/deedle.css" />
    <script src="fsharp.formatting/styles/tips.js" type="text/javascript"></script>
    <!-- For syntax highlighting -->
    <link rel="stylesheet" href="lib/css/zenburn.css">
    <!-- If the query includes 'print-pdf', include the PDF print sheet -->
    <script>
			if( window.location.search.match( /print-pdf/gi ) ) {
				var link = document.createElement( 'link' );
				link.rel = 'stylesheet';
				link.type = 'text/css';
				link.href = 'css/print/pdf.css';
				document.getElementsByTagName( 'head' )[0].appendChild( link );
			}
    </script>
    <!--[if lt IE 9]>
    <script src="lib/js/html5shiv.js"></script>
    <![endif]-->
</head>
<body>
    <div class="reveal">
        <div class="tip" id="fs1">Multiple items<br />val Failure : message:string -&gt; exn<br /><br />Full name: Microsoft.FSharp.Core.Operators.Failure<br /><br />--------------------<br />active recognizer Failure: exn -&gt; string option<br /><br />Full name: Microsoft.FSharp.Core.Operators.( |Failure|_| )</div>
<div class="tip" id="fs2">Multiple items<br />val string : value:&#39;T -&gt; string<br /><br />Full name: Microsoft.FSharp.Core.Operators.string<br /><br />--------------------<br />type string = System.String<br /><br />Full name: Microsoft.FSharp.Core.string</div>
<div class="tip" id="fs3">union case Option.Some: Value: &#39;T -&gt; Option&lt;&#39;T&gt;</div>
<div class="tip" id="fs4">Multiple items<br />module List<br /><br />from Microsoft.FSharp.Collections<br /><br />--------------------<br />type List&lt;&#39;T&gt; =<br />&#160;&#160;| ( [] )<br />&#160;&#160;| ( :: ) of Head: &#39;T * Tail: &#39;T list<br />&#160;&#160;interface IEnumerable<br />&#160;&#160;interface IEnumerable&lt;&#39;T&gt;<br />&#160;&#160;member Head : &#39;T<br />&#160;&#160;member IsEmpty : bool<br />&#160;&#160;member Item : index:int -&gt; &#39;T with get<br />&#160;&#160;member Length : int<br />&#160;&#160;member Tail : &#39;T list<br />&#160;&#160;static member Cons : head:&#39;T * tail:&#39;T list -&gt; &#39;T list<br />&#160;&#160;static member Empty : &#39;T list<br /><br />Full name: Microsoft.FSharp.Collections.List&lt;_&gt;</div>
<div class="tip" id="fs5">val tail : list:&#39;T list -&gt; &#39;T list<br /><br />Full name: Microsoft.FSharp.Collections.List.tail</div>
<div class="tip" id="fs6">union case Option.None: Option&lt;&#39;T&gt;</div>
<div class="tip" id="fs7">Multiple items<br />type NoEqualityAttribute =<br />&#160;&#160;inherit Attribute<br />&#160;&#160;new : unit -&gt; NoEqualityAttribute<br /><br />Full name: Microsoft.FSharp.Core.NoEqualityAttribute<br /><br />--------------------<br />new : unit -&gt; NoEqualityAttribute</div>
<div class="tip" id="fs8">Multiple items<br />type NoComparisonAttribute =<br />&#160;&#160;inherit Attribute<br />&#160;&#160;new : unit -&gt; NoComparisonAttribute<br /><br />Full name: Microsoft.FSharp.Core.NoComparisonAttribute<br /><br />--------------------<br />new : unit -&gt; NoComparisonAttribute</div>
<div class="tip" id="fs9">type &#39;T option = Option&lt;&#39;T&gt;<br /><br />Full name: Microsoft.FSharp.Core.option&lt;_&gt;</div>
<div class="tip" id="fs10">val ignore : value:&#39;T -&gt; unit<br /><br />Full name: Microsoft.FSharp.Core.Operators.ignore</div>
<div class="tip" id="fs11">val fst : tuple:(&#39;T1 * &#39;T2) -&gt; &#39;T1<br /><br />Full name: Microsoft.FSharp.Core.Operators.fst</div>
<div class="tip" id="fs12">module Option<br /><br />from Microsoft.FSharp.Core</div>
<div class="tip" id="fs13">val bind : binder:(&#39;T -&gt; &#39;U option) -&gt; option:&#39;T option -&gt; &#39;U option<br /><br />Full name: Microsoft.FSharp.Core.Option.bind</div>

        <!-- Any section element inside of this container is displayed as a slide -->
        <div class="slides">
            <section >

<section >

<h2>Improve the signal, reduce the noise</h2>

<h3>bring F# to the table</h3>

<p><br><br><br>
<a href="http://twitter.com/tjaskula">@tjaskula</a></p>

<p><a href="http://jaskula.fr">jaskula.fr</a></p>

<p><img src="images/ComposeGreen1.jpg" alt="alt text" title="Compose IT logo" /></p>

</section>

</section>

<section >

<section >

<h3>About me</h3>

<ul>
<li>During the day software <del>architect</del> developer in finance</li>
<li>During the night working on startup project <a href="https://www.rocketcv.pl">rocketcv.pl</a></li>
<li>The rest of the time running two user communities in Paris
<ul>
<li><a href="http://www.meetup.com/Functional-Programming-in-F/">F# user group</a></li>
<li><a href="http://www.meetup.com/DDD-Paris/">Domain Driven Design user group</a></li>
</ul></li>
<li>Tweetting <a href="http://twitter.com/tjaskula">@tjaskula</a> and blogging occasionally at <a href="http://jaskula.fr">jaskula.fr</a></li>
<li>Playing guitar...</li>
</ul>

</section>

</section>

<section >

<section >

<h3>This talk is about</h3>

<p><strong>Benefits</strong> of moving from OOP to FP for a startup project</p>

<aside class="notes">
    I'm not an expert in FP.
    If you're a FP expert so this may learn you nothing. If some people leave I won't be offended.
</aside>

</section>

</section>

<section >

<section >

<p>I've always been an OOP developer</p>

<p>but...</p>

</section>

<section >

<blockquote>
  <p>The snake which cannot cast its skin has to die. As well the minds which are prevented from changing their opinions; they cease to be mind.
<strong>Friedrich Nietzsche</strong></p>
</blockquote>

</section>

</section>

<section >

<section >

<h3>Context</h3>

<p>Building a startup it's not just about writing <strong>the code</strong></p>

</section>

<section >

<h3>Time spent on non technical tasks</h3>

<ul>
<li>Business plan</li>
<li>Market survey</li>
<li>Advertising</li>
<li>Legal</li>
<li>etc.</li>
</ul>

<aside class="notes">
    Legal stuff: privacy policy, terms of use
</aside>

</section>

<section >

<h3>Time spent on technical tasks</h3>

<h4>Not directly related to coding activity</h4>

<ul>
<li>Hosting</li>
<li>Build and deployment processes</li>
<li>Integrating with external web APIs services</li>
<li>etc.</li>
</ul>

<aside class="notes">
    Studying external Apis for point of integration like StackOverflow, GitHub
</aside>

</section>

<section >

<p>Time spent for coding must deliver <strong>real business value</strong></p>

</section>

<section >

<p>Can we measure the part of <strong>business value</strong> inside our code ?</p>

<aside class="notes">
    There is no automatic tool or metric that can be used.
</aside>

</section>

</section>

<section >

<section >

<h3>Introducing to SNR</h3>

<h4>Signal-to-Noise Ratio</h4>

<blockquote>
  <p>Compares a level of desired signal to the level of background noise.</p>
</blockquote>

<p><span class="math">\(\mathrm{SNR} = \frac{\mu_\mathrm{sig}}{\sigma_\mathrm{bg}}\)</span></p>

<aside class="notes">
    Mean (μ)  
    Standard Deviation (σ) 
    SNR = μ / σ = 32 / 11.51086 = 2.7799834243488326

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="i">Signal</span> <span class="k">to</span> <span class="i">noise</span> <span class="i">ratio</span> <span class="i">is</span> <span class="i">a</span> <span class="i">measurement</span> <span class="k">of</span> <span class="i">the</span> <span class="i">audio</span> <span class="i">signal</span> <span class="i">level</span> <span class="i">compared</span> <span class="k">to</span> <span class="i">the</span> <span class="i">noise</span> <span class="i">level</span> <span class="i">present</span> <span class="k">in</span> <span class="i">the</span> <span class="i">signal</span><span class="o">.</span> <span class="i">SNR</span> <span class="i">specifications</span> <span class="i">are</span> <span class="i">used</span> <span class="k">in</span> <span class="i">components</span> <span class="i">such</span> <span class="k">as</span> <span class="i">amplifiers</span>, <span class="i">CD</span><span class="o">/</span><span class="i">DVD</span> <span class="i">players</span> <span class="i">etc</span><span class="o">.</span>,

<span class="i">Signal</span><span class="o">-</span><span class="k">to</span><span class="o">-</span><span class="i">noise</span> <span class="i">ratio</span> <span class="i">is</span> <span class="i">sometimes</span> <span class="i">used</span> <span class="i">informally</span> <span class="k">to</span> <span class="i">refer</span> <span class="k">to</span> <span class="i">the</span> <span class="i">ratio</span> <span class="k">of</span> <span class="i">useful</span> <span class="i">information</span> <span class="k">to</span> <span class="k">false</span> <span class="k">or</span> <span class="i">irrelevant</span> <span class="i">data</span> <span class="k">in</span> <span class="i">a</span> <span class="i">conversation</span> <span class="k">or</span> <span class="i">exchange</span><span class="o">.</span> <span class="i">For</span> <span class="i">example</span>, <span class="k">in</span> <span class="i">online</span> <span class="i">discussion</span> <span class="i">forums</span> <span class="k">and</span> <span class="i">other</span> <span class="i">online</span> <span class="i">communities</span>, <span class="i">off</span><span class="o">-</span><span class="i">topic</span> <span class="i">posts</span> <span class="k">and</span> <span class="i">spam</span> <span class="i">are</span> <span class="i">regarded</span> <span class="k">as</span> <span class="s">&quot;</span><span class="s">noise</span><span class="s">&quot;</span> <span class="i">that</span> <span class="i">interferes</span> <span class="k">with</span> <span class="i">the</span> <span class="s">&quot;</span><span class="s">signal</span><span class="s">&quot;</span> <span class="k">of</span> <span class="i">appropriate</span> <span class="i">discussion</span><span class="o">.</span></pre>
</td>
</tr>
</table>

</aside>

</section>

<section >

<h3>SNR relation to the code</h3>

<p><strong>SIGNAL</strong> = <strong>Information</strong> producing <strong>Business Value</strong><br /><strong>NOISE</strong> = Everything else <strong>impeding</strong> the convey of Information</p>

</section>

<section >

<h3>Signal</h3>

<blockquote>
  <p>"Signal is information which conveys knowledge via facts. Knowledge is <strong>derived</strong> from Facts. Fact is produced by <strong>Business Use Case</strong> in time"</p>
</blockquote>

</section>

<section >

<h3>Signal properties</h3>

<ul>
<li><strong>Fact</strong> that happened incorporated in time</li>
<li>Fact is an <strong>Immutable Value</strong></li>
<li><strong>Decisions</strong> are made on facts (humans and machines)</li>
</ul>

<aside class="notes">
    What is Fact ? it's not a place (like in OOP language) but rather a value Fact = something that happend, that existed, incorporate time
    Knowledge is derived from facts, comparing facts from different time points all the time.
    If mutable in a time a needs to be protected (OOP) (lock?)
    Why this is important ? We can assert on Facts and not on mechanisms
</aside>

</section>

<section >

<h3>Noise</h3>

<blockquote>
  <p>"Everything which infers with a signal and not contribute to the <strong>Knowledge</strong>"</p>
</blockquote>

</section>

<section >

<h3>Noise properties</h3>

<ul>
<li>Irrelevant or false data</li>
<li>Fact mutation</li>
<li>Everything that hinders readability of Facts</li>
</ul>

</section>

<section >

<h3>Categories of code noises</h3>

<ul>
<li>Organization</li>
<li>Readability</li>
<li>Correctness</li>
<li>Expressiveness</li>
<li>Frameworks</li>
<li>Effort</li>
<li>Complexity</li>
</ul>

<aside class="notes">
    Organization : how the code is structured
    Readability : how it is easy to read the code. Most of the time we are reading to understand the code, naming
    Correctness : modeling with types, null reference exceptions, no side effects, try catch
    Expressiveness : how much plumbing code, curly braces punctuations, powerfull type inference
    Frameworks : how many frameworks for DI, AOP, ORMS
    Effort : how difficult is to write code, maintain and refactor, know design patterns etc.
    Complexity : cyclic dependencies, LoC, Cyclomatic Complexity
</aside>

</section>

</section>

<section >

<section >

<h3>Theoretical metric</h3>

<h4>Applicable to each business use case</h4>

<p><span class="math">\(\mathrm{CodeSNR} = \frac{LoC_\mathrm{domainUseCase}}{LoC_\mathrm{total}}\times{100}\)</span></p>

<p>The bigger the CodeSNR is, the better it is</p>

</section>

<section >

<p>Unfortunately there is no automatic tool to measure it...</p>

</section>

<section >

<h3>Categories of noises</h3>

<h4>Can be measured</h4>

<ul>
<li>Correctness</li>
<li>Expressiveness</li>
<li>Frameworks</li>
<li>Complexity</li>
</ul>

</section>

<section >

<h3>Categories of noises</h3>

<h4>Just a subjective estimation</h4>

<ul>
<li>Organization</li>
<li>Readability</li>
<li>Effort</li>
</ul>

</section>

</section>

<section >

<section >

<h3>Let's create a REST service</h3>

<h4>Registration process business rules:</h4>

<ul>
<li>All fields are required (email, password, privacy selection, provider)</li>
<li>Password should match the password policy</li>
<li>Email address should be unique</li>
<li>If user from trusted provider then email is automaticaly confirmed</li>
<li>If not, an activation code should be created and sent to the user's email address</li>
<li>Account is created and password is crypted</li>
</ul>

</section>

</section>

<section >

<section >

<h3>ASP.NET Web Api 2</h3>

<ul>
<li>C# naive implementation</li>
<li>C# OOP implementation</li>
<li>F# implementation</li>
</ul>

</section>

</section>

<section >

<section >

<h3>Registration Use Case</h3>

<p><img src="images/registerUseCase.jpg" alt="alt text" title="Registration use case" /></p>

</section>

</section>

<section >

<section >

<h3>Naive OOP implementation (Page 1)</h3>

<table class="pre"><tr><td><pre lang="csharp">[HttpPost]
[Route(<span class="s">"api/register"</span>)]
<span class="k">public</span> IHttpActionResult Register(RegisterRepresentation rep)
{
    <span class="k">var</span> confirmationUrl <span class="o">=</span> <span class="k">new</span> Uri(Request.RequestUri, <span class="s">"/confirmation"</span>);

    <span class="k">if</span> (ModelState.IsValid)
    {
        <span class="k">if</span> (!Regex.IsMatch(rep.Password,
            <span class="s">@"(?!.*\s)[0-9a-zA-Z!@#\\$%*()_+^&amp;amp;}{:;?.]*$"</span>))
        {
            ModelState.AddModelError(<span class="s">"password"</span>, <span class="s">"The password 
                                            does not match the policy"</span>);
            <span class="k">return</span> BadRequest(ModelState);
        }

        IHttpActionResult response <span class="o">=</span> Ok(); </pre></td></tr></table>

</section>

<section >

<h3>Naive OOP implementation (Page 2)</h3>

<table class="pre"><tr><td><pre lang="csharp"><span class="k">using</span> (<span class="k">var</span> ctx <span class="o">=</span> <span class="k">new</span> RegistrationContext())
{
    <span class="k">if</span> (ctx.Accounts.Any(a <span class="o">=</span><span class="o">&gt;</span> a.Email <span class="o">=</span><span class="o">=</span> rep.Email))
        <span class="k">return</span> Conflict();

    <span class="k">var</span> cryptographer <span class="o">=</span> <span class="k">new</span> Cryptographer();
    <span class="k">string</span> cryptedPassword <span class="o">=</span> cryptographer.GetPasswordHash(
        rep.Password, cryptographer.CreateSalt());

    <span class="k">var</span> account <span class="o">=</span> <span class="k">new</span> Account
    {
        Email <span class="o">=</span> rep.Email,
        Password <span class="o">=</span> cryptedPassword,
        Provider <span class="o">=</span> rep.Provider
    };

    account.ConfirmEmail(DateTime.Now);</pre></td></tr></table>

</section>

<section >

<h3>Naive OOP implementation (Page 3)</h3>

<table class="pre"><tr><td><pre lang="csharp"><span class="k">if</span> (!account.IsEmailConfirmed)
    {
        account.SetActivationCode(Guid.NewGuid(), DateTime.Now.AddDays(5));
        <span class="k">var</span> notifier <span class="o">=</span> <span class="k">new</span> Notifier();
        notifier.SendActivationNotification(account.Email);

        response <span class="o">=</span> Created(confirmationUrl, <span class="k">new</span> ConfirmationRepresentation
        {
            Email <span class="o">=</span> account.Email,
            Code <span class="o">=</span> account.ActivationCode,
            ExpirationTime <span class="o">=</span> account.ActivationCodeExpirationTime.Value
        });
    }
    ctx.Accounts.Add(account);
    ctx.SaveChanges();

    <span class="k">return</span> response;
    }
  }
<span class="k">return</span> BadRequest(ModelState);
}</pre></td></tr></table>

</section>

</section>

<section >

<section >

<h3>Immediate feedback</h3>

<p><img src="images/naive.jpg" alt="alt text" title="Naive use case" /></p>

</section>

<section >

<h3>Observations</h3>

<ul>
<li>Procedural code</li>
<li>State mutation</li>
<li>Decisions made by intermediate steps</li>
<li>Orchestrated by client</li>
<li>Cannot be tested</li>
</ul>

</section>

<section >

<h3>Naive OOP implementation noises</h3>

<p>Lines of code: <strong>399</strong></p>

<ul>
<li>Correctness:       <strong>26%</strong></li>
<li>Expressiveness:    <strong>25%</strong></li>
<li>Frameworks:        <strong>42%</strong></li>
<li>Complexity:        <strong>Max 6 - Average 1.56</strong></li>
<li>Organization:      <strong>Easy</strong></li>
<li>Readability:       <strong>Bad</strong></li>
<li>Effort:            <strong>High</strong>
<br />
<br />
CodeSNR = <strong>7%</strong></li>
</ul>

</section>

</section>

<section >

<section >

<h3>We can do better</h3>

<p>OOP should not be procedural. Let's introduce some abstractions</p>

</section>

<section >

<table class="pre"><tr><td><pre lang="csharp"><span class="k">public</span> <span class="k">interface</span> IRepresentationValidator
{
    <span class="k">bool</span> Validate(RegisterRepresentation representation);
}

<span class="k">public</span> <span class="k">interface</span> IRegistrationService
{
    <span class="k">bool</span> ShouldConfirmSubscription(RegisterRepresentation rep);
    <span class="k">bool</span> CanRegister(<span class="k">string</span> accountEmail, 
                        Func&lt;<span class="k">string</span>, Account&gt; canRegister);
    Account Register(RegisterRepresentation rep);
}

<span class="k">public</span> <span class="k">interface</span> INotifier
{
    <span class="k">void</span> SendActivationNotification(<span class="k">string</span> emailAddress);
}

<span class="k">public</span> <span class="k">interface</span> IAccountRepository
{
    Account FindByEmail(<span class="k">string</span> email);
    <span class="k">void</span> Save(Account account);
}</pre></td></tr></table>

</section>

</section>

<section >

<section >

<h3>Refactored OOP implementation (Page 1)</h3>

<table class="pre"><tr><td><pre lang="csharp">[HttpPost]
[Route(<span class="s">"api/register"</span>)]
<span class="k">public</span> IHttpActionResult Register(RegisterRepresentation rep)
{
    <span class="k">var</span> confirmUrl <span class="o">=</span> <span class="k">new</span> Uri(Request.RequestUri, <span class="s">"/confirm..."</span>);

    <span class="k">if</span> (_validator.Validate(rep))
        ModelState.AddModelError(<span class="s">"password"</span>, 
                <span class="s">"The password format does not match the policy"</span>);

    <span class="k">if</span> (ModelState.IsValid)
    {
        <span class="k">if</span> (!_registrationService.CanRegister(rep.Email,
                email <span class="o">=</span><span class="o">&gt;</span> _accountRepository.FindByEmail(email)))
            <span class="k">return</span> Conflict();

        IHttpActionResult response <span class="o">=</span> Ok();
        <span class="c">// what if this is null ?</span>
        <span class="k">var</span> account <span class="o">=</span> _registrationService.Register(rep);</pre></td></tr></table>

</section>

<section >

<h3>Refactored OOP implementation (Page 2)</h3>

<table class="pre"><tr><td><pre lang="csharp"><span class="k">if</span> (_registrationService.ShouldConfirmSubscription(rep))
        {
            account.SetActivationCode(Guid.NewGuid(), 
                                    DateTime.Now.AddDays(5));
            _notifier.SendActivationNotification(account.Email);

            response <span class="o">=</span> Created(confirmUrl, 
                <span class="k">new</span> ConfirmationRepresentation
                {
                    Email <span class="o">=</span> account.Email,
                    Code <span class="o">=</span> account.ActivationCode,
                    ExpirationTime <span class="o">=</span> 
                        account.ActivationCodeExpirationTime.Value
                });
        }
        _accountRepository.Save(account);
        <span class="k">return</span> response;
    }
    <span class="k">return</span> BadRequest(ModelState);
}</pre></td></tr></table>

</section>

</section>

<section >

<section >

<h3>Immediate feedback</h3>

<p><img src="images/refactored.jpg" alt="alt text" title="Refactored use case" /></p>

</section>

<section >

<h3>Observations</h3>

<ul>
<li>Composition through dependencies and abstractions</li>
<li>State mutation</li>
<li>Decisions made by intermediate steps</li>
<li>Orchestrated by client</li>
<li>Testable</li>
<li>Lines of code explosion because of new "abstractions"</li>
</ul>

</section>

<section >

<h3>Refactored OOP implementation noises</h3>

<p>Lines of code: <strong>574</strong> (+45%)</p>

<ul>
<li>Correctness:       <strong>25%</strong> (+1%)</li>
<li>Expressiveness:    <strong>34%</strong> (+9%)</li>
<li>Frameworks:        <strong>42%</strong> (-6%)</li>
<li>Complexity:        <strong>Max 5 - Average 1.56</strong></li>
<li>Organization:      <strong>Hard</strong></li>
<li>Readability:       <strong>Good</strong></li>
<li>Effort:            <strong>Medium</strong>
<br />
<br />
CodeSNR = <strong>5%</strong> (-2%)</li>
</ul>

</section>

</section>

<section >

<section >

<h3>Some noises</h3>

<p>Language construction</p>

<table class="pre"><tr><td><pre lang="csharp"><span class="k">public</span> RegisterController(
        IAccountRepository accountRepository,
        IRepresentationValidator validator,
        IRegistrationService registrationService,
        INotifier notifier)
{
    <span class="k">if</span> (accountRepository <span class="o">=</span><span class="o">=</span> <span class="k">null</span>)
        <span class="k">throw</span> <span class="k">new</span> ArgumentNullException(<span class="s">"accountRepository"</span>);
    <span class="k">if</span> (validator <span class="o">=</span><span class="o">=</span> <span class="k">null</span>)
        <span class="k">throw</span> <span class="k">new</span> ArgumentNullException(<span class="s">"validator"</span>);
    <span class="k">if</span> (registrationService <span class="o">=</span><span class="o">=</span> <span class="k">null</span>)
        <span class="k">throw</span> <span class="k">new</span> ArgumentNullException(<span class="s">"validator"</span>);
    <span class="k">if</span> (notifier <span class="o">=</span><span class="o">=</span> <span class="k">null</span>)
        <span class="k">throw</span> <span class="k">new</span> ArgumentNullException(<span class="s">"notifier"</span>);

    _accountRepository <span class="o">=</span> accountRepository;
    _validator <span class="o">=</span> validator;
    _registrationService <span class="o">=</span> registrationService;
    _notifier <span class="o">=</span> notifier;
}</pre></td></tr></table>

</section>

<section >

<h3>Some noises</h3>

<ul>
<li>Introduction of ORM framework</li>
<li>Introduction of DI framework</li>
<li>Introduction of Mappers between layers</li>
</ul>

</section>

<section >

<h3>Some noises</h3>

<p>Interface map to implementation 1:1</p>

<p><img src="images/CSharpRefactoredProj.jpg" alt="alt text" title="Too many implementations and abstractions" /></p>

</section>

<section >

<h3>Some noises</h3>

<ul>
<li>Reused Abstraction Principle violated</li>
</ul>

</section>

</section>

<section >

<section >

<h3>F# signal improvement</h3>

<p>HTTP is a functional type</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">type</span> <span class="i">Http</span> <span class="o">=</span> <span class="i">Request</span> <span class="k">-&gt;</span> <span class="i">Response</span></pre>
</td>
</tr>
</table>

</section>

<section >

<h3>Business Use Case as a function</h3>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">let</span> <span class="i">useCase</span> <span class="o">=</span> <span class="o">&#39;</span><span class="i">Input</span> <span class="k">-&gt;</span> <span class="o">&#39;</span><span class="i">Fact</span></pre>
</td>
</tr>
</table>

</section>

<section >

<h3>Http as function</h3>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">type</span> <span class="i">Http</span> <span class="o">=</span> <span class="i">Request</span><span class="o">&lt;</span><span class="o">&#39;</span><span class="i">T</span><span class="o">&gt;</span> <span class="k">-&gt;</span> 

            <span class="c">// business use case</span>
            (<span class="o">&#39;</span><span class="i">Input</span> <span class="k">-&gt;</span> <span class="o">&#39;</span><span class="i">Fact</span>) <span class="k">-&gt;</span>

            <span class="i">Response</span><span class="o">&lt;</span><span class="o">&#39;</span><span class="i">Fact</span><span class="o">&gt;</span></pre>
</td>
</tr>
</table>

</section>

<section >

<h3>Error handling</h3>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
<span class="l">8: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">type</span> <span class="i">Result</span><span class="o">&lt;</span><span class="o">&#39;</span><span class="i">TSuccess</span>,<span class="o">&#39;</span><span class="i">TFailure</span><span class="o">&gt;</span> <span class="o">=</span> 
    | <span class="i">Success</span> <span class="k">of</span> <span class="o">&#39;</span><span class="i">TSuccess</span>
    | <span onmouseout="hideTip(event, 'fs1', 1)" onmouseover="showTip(event, 'fs1', 1)" class="i">Failure</span> <span class="k">of</span> <span class="o">&#39;</span><span class="i">TFailure</span>

<span class="k">type</span> <span class="i">Error</span> <span class="o">=</span>
    | <span class="i">ValidationError</span> <span class="k">of</span> <span onmouseout="hideTip(event, 'fs2', 2)" onmouseover="showTip(event, 'fs2', 2)" class="i">string</span>
    | <span class="i">AccountExists</span> <span class="k">of</span> <span onmouseout="hideTip(event, 'fs2', 3)" onmouseover="showTip(event, 'fs2', 3)" class="i">string</span>
    | <span class="i">DatabaseError</span> <span class="k">of</span> <span onmouseout="hideTip(event, 'fs2', 4)" onmouseover="showTip(event, 'fs2', 4)" class="i">string</span></pre>
</td>
</tr>
</table>

<p>*Railway Programming <a href="http://fsharpforfunandprofit.com/posts/recipe-part2/">http://fsharpforfunandprofit.com/posts/recipe-part2/</a></p>

</section>

<section >

<h3>Http as function with error handling</h3>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">type</span> <span class="i">Http</span> <span class="o">=</span> <span class="i">Request</span><span class="o">&lt;</span><span class="o">&#39;</span><span class="i">T</span><span class="o">&gt;</span> <span class="k">-&gt;</span> 

            <span class="c">// business use case</span>
            (<span class="o">&#39;</span><span class="i">T</span> <span class="k">-&gt;</span> <span class="i">Result</span><span class="o">&lt;</span><span class="o">&#39;</span><span class="i">Fact</span>, <span class="i">Error</span><span class="o">&gt;</span>) <span class="k">-&gt;</span>

            <span class="i">Response</span><span class="o">&lt;</span>_<span class="o">&gt;</span></pre>
</td>
</tr>
</table>

</section>

<section >

<h3>Business use case</h3>

<ul>
<li>validate input</li>
<li>invoke domain</li>
<li>persist</li>
<li>return result or error</li>
</ul>

</section>

</section>

<section >

<section >

<h3>Step 1 : Input validation</h3>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">let</span> <span class="i">passwordPolicy</span> <span class="i">registerRepresentation</span> <span class="o">=</span>

  <span class="k">match</span> <span class="i">registerRepresentation</span><span class="o">.</span><span class="i">Password</span> <span class="k">with</span>
    | <span class="i">Match</span> <span class="s">@&quot;</span><span class="s">(</span><span class="s">?</span><span class="s">!</span><span class="s">.</span><span class="s">*</span><span class="s">\</span><span class="s">s</span><span class="s">)</span><span class="s">[</span><span class="s">0</span><span class="s">-</span><span class="s">9</span><span class="s">a</span><span class="s">-</span><span class="s">zA</span><span class="s">-</span><span class="s">Z</span><span class="s">!</span><span class="s">@</span><span class="s">#</span><span class="s">\</span><span class="s">\</span><span class="s">$</span><span class="s">%</span><span class="s">*</span><span class="s">(</span><span class="s">)</span><span class="s">_</span><span class="s">+</span><span class="s">$</span><span class="s">&quot;</span> _ <span class="k">-&gt;</span> 
                <span class="i">registerRepresentation</span> <span class="o">|&gt;</span> <span class="i">Success</span>
    | _ <span class="k">-&gt;</span>  <span class="i">ValidationError</span>(<span class="s">&quot;</span><span class="s">The</span><span class="s"> </span><span class="s">password</span><span class="s"> </span><span class="s">format</span><span class="s"> </span><span class="s">does</span><span class="s"> </span>
<span class="s">                                    </span><span class="s">not</span><span class="s"> </span><span class="s">match</span><span class="s"> </span><span class="s">the</span><span class="s"> </span><span class="s">policy</span><span class="s">&quot;</span>) 
                                       <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs1', 5)" onmouseover="showTip(event, 'fs1', 5)" class="i">Failure</span>

<span class="c">//-----------------</span>

<span class="k">val</span> <span class="i">passwordPolicy</span> <span class="o">:</span> <span class="i">RegisterRepresentation</span> 
                      <span class="k">-&gt;</span> <span class="i">Result</span><span class="o">&lt;</span><span class="i">RegisterRepresentation</span>, <span class="i">Error</span><span class="o">&gt;</span></pre>
</td>
</tr>
</table>

</section>

<section >

<h3>Active patterns</h3>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">let</span> (|<span class="i">Match</span>|_|) <span class="i">regex</span> <span class="i">str</span> <span class="o">=</span>
    <span class="k">let</span> <span class="i">m</span> <span class="o">=</span> <span class="i">Regex</span>(<span class="i">regex</span>)<span class="o">.</span><span class="i">Match</span>(<span class="i">str</span>)
    <span class="k">match</span> <span class="i">m</span><span class="o">.</span><span class="i">Success</span> <span class="k">with</span>
      | <span class="k">true</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs3', 6)" onmouseover="showTip(event, 'fs3', 6)" class="i">Some</span> (<span onmouseout="hideTip(event, 'fs4', 7)" onmouseover="showTip(event, 'fs4', 7)" class="i">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs5', 8)" onmouseover="showTip(event, 'fs5', 8)" class="i">tail</span> [<span class="k">for</span> <span class="i">g</span> <span class="k">in</span> <span class="i">m</span><span class="o">.</span><span class="i">Groups</span> <span class="k">-&gt;</span> <span class="i">g</span><span class="o">.</span><span class="i">Value</span>])
      | <span class="k">false</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs6', 9)" onmouseover="showTip(event, 'fs6', 9)" class="i">None</span></pre>
</td>
</tr>
</table>

</section>

<section >

<h3>Input validation composition</h3>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">let</span> <span class="i">validateAll</span> <span class="o">=</span>
    <span class="i">passwordPolicy</span> <span class="o">&amp;&amp;&amp;</span> <span class="i">checkPrivacy</span>

<span class="c">//-----------------</span>
<span class="k">val</span> <span class="i">validateAll</span> <span class="o">:</span> (<span class="i">RegisterRepresentation</span> 
                      <span class="k">-&gt;</span> <span class="i">Result</span><span class="o">&lt;</span><span class="i">RegisterRepresentation</span>, <span class="i">Error</span><span class="o">&gt;</span>)</pre>
</td>
</tr>
</table>

</section>

<section >

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
<span class="l">8: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">let</span> (<span class="o">&amp;&amp;&amp;</span>) <span class="i">v1</span> <span class="i">v2</span> <span class="o">=</span> 
    <span class="k">let</span> <span class="i">addSuccess</span> <span class="i">r1</span> <span class="i">r2</span> <span class="o">=</span> <span class="i">r1</span> <span class="c">// return first</span>
    <span class="k">let</span> <span class="i">addFailure</span> <span class="i">s1</span> <span class="i">s2</span> <span class="o">=</span> <span class="i">concatErrors</span> [<span class="i">s1</span>; <span class="i">s2</span>]  <span class="c">// concat</span>
    <span class="i">plus</span> <span class="i">addSuccess</span> <span class="i">addFailure</span> <span class="i">v1</span> <span class="i">v2</span> 

<span class="c">//-----------------</span>
<span class="k">val</span> <span class="i">v1</span><span class="o">:</span> (<span class="o">&#39;</span><span class="i">a</span> <span class="k">-&gt;</span> <span class="i">Result</span><span class="o">&lt;</span><span class="o">&#39;</span><span class="i">b</span>, <span class="i">Error</span><span class="o">&gt;</span>)
<span class="k">val</span> <span class="i">v2</span><span class="o">:</span> (<span class="o">&#39;</span><span class="i">a</span> <span class="k">-&gt;</span> <span class="i">Result</span><span class="o">&lt;</span><span class="o">&#39;</span><span class="i">c</span>, <span class="i">Error</span><span class="o">&gt;</span>)</pre>
</td>
</tr>
</table>

</section>

</section>

<section >

<section >

<h3>Registration use case</h3>

<h4>After step 1</h4>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">let</span> <span class="i">useCase</span> <span class="o">=</span> <span class="i">Validation</span><span class="o">.</span><span class="i">validateAll</span>

<span class="c">//-----------------</span>
(<span class="i">RegisterRepresentation</span> <span class="k">-&gt;</span>
 <span class="i">Result</span><span class="o">&lt;</span><span class="i">RegisterRepresentation</span>,<span class="i">Domain</span><span class="o">.</span><span class="i">Error</span><span class="o">&gt;</span>)</pre>
</td>
</tr>
</table>

</section>

</section>

<section >

<section >

<h3>Step 2 : Designing domain with types</h3>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">type</span> <span class="i">EmailAddress</span> <span class="o">=</span> <span class="i">EmailAddress</span> <span class="k">of</span> <span onmouseout="hideTip(event, 'fs2', 10)" onmouseover="showTip(event, 'fs2', 10)" class="i">string</span>

<span class="k">type</span> <span class="i">VerifiedEmailAddress</span> <span class="o">=</span> <span class="i">VerifiedEmail</span> <span class="k">of</span> <span class="i">EmailAddress</span>

<span class="k">type</span> <span class="i">EmailAddressContactInfo</span> <span class="o">=</span>
    | <span class="i">Unverified</span> <span class="k">of</span> <span class="i">EmailAddress</span>
    | <span class="i">Verified</span> <span class="k">of</span> <span class="i">VerifiedEmailAddress</span>

[&lt;<span onmouseout="hideTip(event, 'fs7', 11)" onmouseover="showTip(event, 'fs7', 11)" class="i">NoEquality</span>;<span onmouseout="hideTip(event, 'fs8', 12)" onmouseover="showTip(event, 'fs8', 12)" class="i">NoComparison</span>&gt;]
<span class="k">type</span> <span class="i">Account</span> <span class="o">=</span>
    {
        <span class="i">Email</span> <span class="o">:</span> <span class="i">EmailAddressContactInfo</span>
        <span class="i">Password</span> <span class="o">:</span> <span onmouseout="hideTip(event, 'fs2', 13)" onmouseover="showTip(event, 'fs2', 13)" class="i">string</span>
        <span class="i">Provider</span> <span class="o">:</span> <span onmouseout="hideTip(event, 'fs2', 14)" onmouseover="showTip(event, 'fs2', 14)" class="i">string</span>
        <span class="i">Confirmation</span> <span class="o">:</span> <span class="i">ConfirmationInfo</span> <span onmouseout="hideTip(event, 'fs9', 15)" onmouseover="showTip(event, 'fs9', 15)" class="i">option</span>
    }</pre>
</td>
</tr>
</table>

<aside class="notes">
In functional design though, having "dumb data" with transparency is preferred. It is normally fine for the data to be exposed without being encapsulated. The data is immutable, so it can't get "damaged" by a misbehaving function. And it turns out that the focus on transparent data allows for more code that is more flexible and generic.

<p>OO classes shouls have behaviour operating on private state. Just state is a bad design "Anemic domain". In F# data is separated from functions
</aside></p>

</section>

<section >

<h3>Designing with types</h3>

<blockquote>
  <p>"It is better to have 100 functions operate on one data structure than 10 functions on 10 data structures" -- Alan Perlis</p>
</blockquote>

<aside class="notes">
    OO classes shouls have behaviour operating on private state. Just state is a bad design "Anemic domain". In F# data is separated from functions
</aside>

</section>

<section >

<h3>Mapping to domain</h3>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
<span class="l">8: </span>
<span class="l">9: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">let</span> <span class="i">normalizeEmail</span> <span class="i">registerRepresentation</span> <span class="o">=</span>
{
    <span class="i">Account</span><span class="o">.</span><span class="i">Email</span> <span class="o">=</span> 
        <span class="i">registerRepresentation</span><span class="o">.</span><span class="i">Email</span><span class="o">.</span><span class="i">Trim</span>()<span class="o">.</span><span class="i">ToLower</span>() 
                    <span class="o">|&gt;</span> <span class="i">EmailAddress</span> <span class="o">|&gt;</span> <span class="i">Unverified</span>
    <span class="i">Password</span> <span class="o">=</span> <span class="i">registerRepresentation</span><span class="o">.</span><span class="i">Password</span>
    <span class="i">Provider</span> <span class="o">=</span> <span class="i">registerRepresentation</span><span class="o">.</span><span class="i">Provider</span>
    <span class="i">Confirmation</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs6', 16)" onmouseover="showTip(event, 'fs6', 16)" class="i">None</span>
}</pre>
</td>
</tr>
</table>

</section>

<section >

<h3>Registration use case</h3>

<h4>After step 2</h4>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">let</span> <span class="i">useCase</span> <span class="o">=</span> 
    <span class="i">Validation</span><span class="o">.</span><span class="i">validateAll</span>
    <span class="o">&gt;</span><span class="o">&gt;</span> <span class="i">map</span> <span class="i">Validation</span><span class="o">.</span><span class="i">normalizeEmail</span>

<span class="c">//-----------------</span>
(<span class="i">RegisterRepresentation</span> <span class="k">-&gt;</span>
    <span class="i">Result</span><span class="o">&lt;</span><span class="i">Account</span>,<span class="i">Domain</span><span class="o">.</span><span class="i">Error</span><span class="o">&gt;</span>)</pre>
</td>
</tr>
</table>

</section>

<section >

<h3>Map function</h3>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">let</span> <span class="i">map</span> <span class="i">f</span> <span class="i">x</span> <span class="o">=</span>
    <span class="k">match</span> <span class="i">x</span> <span class="k">with</span>
        | <span class="i">Success</span> <span class="i">s</span> <span class="k">-&gt;</span> <span class="i">Success</span>(<span class="i">f</span> <span class="i">s</span>)
        | <span onmouseout="hideTip(event, 'fs1', 17)" onmouseover="showTip(event, 'fs1', 17)" class="i">Failure</span> <span class="i">f</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs1', 18)" onmouseover="showTip(event, 'fs1', 18)" class="i">Failure</span> <span class="i">f</span></pre>
</td>
</tr>
</table>

</section>

</section>

<section >

<section >

<h3>Step 3 : Domain logic and types</h3>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="i">llet</span> <span class="i">tryConfirmEmail</span> <span class="i">account</span> <span class="o">=</span>
    <span class="k">match</span> <span class="i">account</span><span class="o">.</span><span class="i">Email</span> <span class="k">with</span>
        | <span class="i">Unverified</span> <span class="i">e</span> <span class="k">when</span> <span class="i">account</span><span class="o">.</span><span class="i">Provider</span> <span class="o">=</span> <span class="s">&quot;</span><span class="s">OAuth</span><span class="s">&quot;</span> <span class="k">-&gt;</span> 
            {<span class="i">account</span> <span class="k">with</span> <span class="i">Email</span> <span class="o">=</span> <span class="i">e</span> 
                <span class="o">|&gt;</span> <span class="i">VerifiedEmail</span> 
                <span class="o">|&gt;</span> <span class="i">Verified</span>}
                <span class="o">|&gt;</span> <span class="i">Success</span>
        | <span class="i">Unverified</span> _ <span class="k">-&gt;</span> <span class="i">account</span> <span class="o">|&gt;</span> <span class="i">Success</span>
        | <span class="i">Verified</span> _ <span class="k">-&gt;</span> 
                <span class="s">&quot;</span><span class="s">Email</span><span class="s"> </span><span class="s">can&#39;t</span><span class="s"> </span><span class="s">be</span><span class="s"> </span><span class="s">verified</span><span class="s"> </span><span class="s">at</span><span class="s"> </span><span class="s">this</span><span class="s"> </span><span class="s">step</span><span class="s">&quot;</span>
                 <span class="o">|&gt;</span> <span class="i">ValidationError</span>
                 <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs1', 19)" onmouseover="showTip(event, 'fs1', 19)" class="i">Failure</span></pre>
</td>
</tr>
</table>

</section>

<section >

<h3>Registration use case</h3>

<h4>After step 3</h4>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
<span class="l">8: </span>
<span class="l">9: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">let</span> <span class="i">useCase</span> <span class="o">=</span> 
    <span class="i">Validation</span><span class="o">.</span><span class="i">validateAll</span>
    <span class="o">&gt;</span><span class="o">&gt;</span> <span class="i">map</span> <span class="i">Validation</span><span class="o">.</span><span class="i">normalizeEmail</span>
    <span class="o">&gt;</span><span class="o">&gt;</span> <span class="i">bind</span> <span class="i">RegistrationService</span><span class="o">.</span><span class="i">tryConfirmEmail</span>
    <span class="o">&gt;</span><span class="o">&gt;</span> <span class="i">bind</span> <span class="i">RegistrationService</span><span class="o">.</span><span class="i">setActivationCode</span>

<span class="c">//-----------------</span>
(<span class="i">RegisterRepresentation</span> <span class="k">-&gt;</span>
    <span class="i">Result</span><span class="o">&lt;</span><span class="i">Account</span>,<span class="i">Domain</span><span class="o">.</span><span class="i">Error</span><span class="o">&gt;</span>)</pre>
</td>
</tr>
</table>

</section>

<section >

<h3>Bind function</h3>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">let</span> <span class="i">bind</span> <span class="i">f</span> <span class="i">x</span> <span class="o">=</span>
    <span class="k">match</span> <span class="i">x</span> <span class="k">with</span>
        | <span class="i">Success</span> <span class="i">s</span> <span class="k">-&gt;</span> <span class="i">f</span> <span class="i">s</span>
        | <span onmouseout="hideTip(event, 'fs1', 20)" onmouseover="showTip(event, 'fs1', 20)" class="i">Failure</span> <span class="i">f</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs1', 21)" onmouseover="showTip(event, 'fs1', 21)" class="i">Failure</span> <span class="i">f</span></pre>
</td>
</tr>
</table>

</section>

</section>

<section >

<section >

<h3>Persisting with Type Providers</h3>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">let</span> <span class="i">persistRegistration</span> <span class="o">=</span>
    <span class="i">tryCatch</span> (<span class="i">tee</span> (<span class="i">save</span> <span class="i">mapRegistration</span>)) 
            (<span class="k">fun</span> <span class="i">ex</span> <span class="k">-&gt;</span> <span class="i">DatabaseError</span>(<span class="i">ex</span><span class="o">.</span><span class="i">Message</span>))

<span class="c">//-----------------</span>
<span class="k">val</span> <span class="i">persistRegistration</span><span class="o">:</span> (<span class="i">Account</span> <span class="k">-&gt;</span> <span class="i">Result</span><span class="o">&lt;</span><span class="i">Account</span>,<span class="i">Error</span><span class="o">&gt;</span>)</pre>
</td>
</tr>
</table>

</section>

<section >

<h3>Returning a result from dead end</h3>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">let</span> <span class="i">tee</span> <span class="i">f</span> <span class="i">x</span> <span class="o">=</span>
    <span class="i">f</span> <span class="i">x</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs10', 22)" onmouseover="showTip(event, 'fs10', 22)" class="i">ignore</span>
    <span class="i">x</span></pre>
</td>
</tr>
</table>

</section>

<section >

<h3>Try catch</h3>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">let</span> <span class="i">tryCatch</span> <span class="i">f</span> <span class="i">exnHandler</span> <span class="i">x</span> <span class="o">=</span>
    <span class="k">try</span>
        <span class="i">f</span> <span class="i">x</span> <span class="o">|&gt;</span> <span class="i">Success</span>
    <span class="k">with</span>
    | <span class="i">ex</span> <span class="k">-&gt;</span> <span class="i">exnHandler</span> <span class="i">ex</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs1', 23)" onmouseover="showTip(event, 'fs1', 23)" class="i">Failure</span></pre>
</td>
</tr>
</table>

</section>

<section >

<h3>Persistance mapping with Type Providers</h3>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
<span class="l">20: </span>
<span class="l">21: </span>
<span class="l">22: </span>
<span class="l">23: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">type</span> <span class="i">dbSchema</span> <span class="o">=</span> <span class="i">SqlDataConnection</span><span class="o">&lt;</span><span class="s">&quot;</span><span class="s">.</span><span class="s">.</span><span class="s">.</span><span class="s">&quot;</span><span class="o">&gt;</span>

<span class="k">let</span> <span class="i">save</span> <span class="i">map</span> <span class="i">input</span> <span class="o">=</span>

    <span class="k">let</span> <span class="i">db</span> <span class="o">=</span> <span class="i">dbSchema</span><span class="o">.</span><span class="i">GetDataContext</span>()

    <span class="k">let</span> <span class="i">newRecord</span> <span class="o">=</span> <span class="i">map</span> <span class="i">input</span>

    <span class="i">db</span><span class="o">.</span><span class="i">AccountEntity</span><span class="o">.</span><span class="i">InsertOnSubmit</span>(<span class="i">newRecord</span>)
    <span class="i">db</span><span class="o">.</span><span class="i">DataContext</span><span class="o">.</span><span class="i">SubmitChanges</span>()

<span class="k">let</span> <span class="i">mapRegistration</span> <span class="i">input</span> <span class="o">=</span>

    <span class="k">let</span> <span class="i">newRecord</span> <span class="o">=</span> <span class="k">new</span> <span class="i">dbSchema</span><span class="o">.</span><span class="i">ServiceTypes</span><span class="o">.</span><span class="i">AccountEntity</span>()

    <span class="i">newRecord</span><span class="o">.</span><span class="i">Password</span> <span class="o">&lt;-</span> <span class="i">input</span><span class="o">.</span><span class="i">Password</span>
    <span class="i">newRecord</span><span class="o">.</span><span class="i">Provider</span> <span class="o">&lt;-</span> <span class="i">input</span><span class="o">.</span><span class="i">Provider</span>

    <span class="k">let</span> <span class="i">email</span>, <span class="i">isConfirmed</span> <span class="o">=</span> <span class="i">getEmail</span> <span class="i">input</span>
    <span class="i">newRecord</span><span class="o">.</span><span class="i">Email</span> <span class="o">&lt;-</span> <span class="i">email</span>
    <span class="i">newRecord</span><span class="o">.</span><span class="i">IsEmailConfirmed</span> <span class="o">&lt;-</span> <span class="i">isConfirmed</span>

    <span class="i">newRecord</span></pre>
</td>
</tr>
</table>

</section>

</section>

<section >

<section >

<h3>Compose business use case</h3>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
<span class="l">8: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">let</span> <span class="i">start</span> <span class="o">=</span>
        <span class="i">Validation</span><span class="o">.</span><span class="i">validateAll</span>
        <span class="o">&gt;</span><span class="o">&gt;</span> <span class="i">map</span> <span class="i">Validation</span><span class="o">.</span><span class="i">normalizeEmail</span>
        <span class="o">&gt;</span><span class="o">&gt;</span> <span class="i">bind</span> <span class="i">RegistrationService</span><span class="o">.</span><span class="i">tryConfirmEmail</span>
        <span class="o">&gt;</span><span class="o">&gt;</span> <span class="i">bind</span> <span class="i">RegistrationService</span><span class="o">.</span><span class="i">setActivationCode</span>
        <span class="o">&gt;</span><span class="o">&gt;</span> <span class="i">bind</span> <span class="i">Database</span><span class="o">.</span><span class="i">findByEmailRegistration</span>
        <span class="o">&gt;</span><span class="o">&gt;</span> <span class="i">bind</span> <span class="i">Database</span><span class="o">.</span><span class="i">persistRegistration</span>
        <span class="o">&gt;</span><span class="o">&gt;</span> <span class="i">bind</span> <span class="i">Notification</span><span class="o">.</span><span class="i">sendActivationEmail</span></pre>
</td>
</tr>
</table>

</section>

<section >

<h3>Compose business use case'</h3>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
<span class="l">8: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">let</span> <span class="i">start</span> <span class="i">x</span> <span class="o">=</span>
    <span class="i">Validation</span><span class="o">.</span><span class="i">validateAll</span>
    <span class="o">&gt;</span><span class="o">&gt;</span> <span class="i">map</span> <span class="i">Validation</span><span class="o">.</span><span class="i">normalizeEmail</span>
    <span class="o">&gt;</span><span class="o">=&gt;</span> <span class="i">RegistrationService</span><span class="o">.</span><span class="i">tryConfirmEmail</span>
    <span class="o">&gt;</span><span class="o">=&gt;</span> <span class="i">RegistrationService</span><span class="o">.</span><span class="i">setActivationCode</span>
    <span class="o">&gt;</span><span class="o">=&gt;</span> <span class="i">Database</span><span class="o">.</span><span class="i">findByEmailRegistration</span>
    <span class="o">&gt;</span><span class="o">=&gt;</span> <span class="i">Database</span><span class="o">.</span><span class="i">persistRegistration</span>
    <span class="o">&gt;</span><span class="o">=&gt;</span> <span class="i">Notification</span><span class="o">.</span><span class="i">sendActivationEmail</span></pre>
</td>
</tr>
</table>

</section>

<section >

<h3>Bind infix operator</h3>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">let</span> (<span class="o">&gt;</span><span class="o">&gt;</span><span class="o">=</span>) <span class="i">m</span> <span class="i">f</span> <span class="o">=</span>
    <span class="i">bind</span> <span class="i">f</span> <span class="i">m</span>

<span class="c">// kleisli operator</span>
<span class="k">let</span> (<span class="o">&gt;</span><span class="o">=&gt;</span>) <span class="i">f1</span> <span class="i">f2</span> <span class="o">=</span> 
    <span class="k">fun</span> <span class="i">x</span> <span class="k">-&gt;</span> <span class="i">f1</span> <span class="i">x</span> <span class="o">&gt;</span><span class="o">&gt;</span><span class="o">=</span> <span class="i">f2</span></pre>
</td>
</tr>
</table>

</section>

<section >

<h3>Compose business use case''</h3>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
<span class="l">8: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">let</span> <span class="i">start</span> <span class="i">x</span> <span class="o">=</span>
    <span class="i">Validation</span><span class="o">.</span><span class="i">validateAll</span>
    <span class="o">&gt;</span><span class="o">!&gt;</span> <span class="i">Validation</span><span class="o">.</span><span class="i">normalizeEmail</span>
    <span class="o">&gt;</span><span class="o">=&gt;</span> <span class="i">RegistrationService</span><span class="o">.</span><span class="i">tryConfirmEmail</span>
    <span class="o">&gt;</span><span class="o">=&gt;</span> <span class="i">RegistrationService</span><span class="o">.</span><span class="i">setActivationCode</span>
    <span class="o">&gt;</span><span class="o">=&gt;</span> <span class="i">Database</span><span class="o">.</span><span class="i">findByEmailRegistration</span>
    <span class="o">&gt;</span><span class="o">=&gt;</span> <span class="i">Database</span><span class="o">.</span><span class="i">persistRegistration</span>
    <span class="o">&gt;</span><span class="o">=&gt;</span> <span class="i">Notification</span><span class="o">.</span><span class="i">sendActivationEmail</span></pre>
</td>
</tr>
</table>

</section>

<section >

<h3>Map infix operator</h3>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">let</span> (<span class="o">&lt;!&gt;</span>) <span class="i">m</span> <span class="i">f</span> <span class="o">=</span> 
      <span class="i">map</span> <span class="i">f</span> <span class="i">m</span>

<span class="k">let</span> (<span class="o">&gt;</span><span class="o">!&gt;</span>) <span class="i">f1</span> <span class="i">f2</span> <span class="o">=</span> 
    <span class="k">fun</span> <span class="i">x</span> <span class="k">-&gt;</span> <span class="i">f1</span> <span class="i">x</span> <span class="o">&lt;!&gt;</span> <span class="i">f2</span></pre>
</td>
</tr>
</table>

</section>

<section >

<h3>Register it within Web Api framework</h3>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">type</span> <span class="i">CustomControllerActivator</span>() <span class="o">=</span>
    <span class="k">interface</span> <span class="i">IHttpControllerActivator</span> <span class="k">with</span>
        <span class="k">member</span> <span class="i">x</span><span class="o">.</span><span class="i">Create</span>(<span class="i">request</span>, <span class="i">controllerDescriptor</span>, 
                            <span class="i">controllerType</span>) <span class="o">=</span>
            <span class="k">new</span> <span class="i">RegisterController</span>(<span class="i">UseCases</span><span class="o">.</span><span class="i">Registration</span><span class="o">.</span><span class="i">start</span>) 
                                            <span class="o">:&gt;</span> <span class="i">IHttpController</span></pre>
</td>
</tr>
</table>

</section>

<section >

<h3>Handle it</h3>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
<span class="l">20: </span>
<span class="l">21: </span>
<span class="l">22: </span>
<span class="l">23: </span>
<span class="l">24: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
[&lt;<span class="i">HttpPost</span>&gt;]
[&lt;<span class="i">Route</span>(<span class="s">&quot;</span><span class="s">api</span><span class="s">/</span><span class="s">register</span><span class="s">&quot;</span>)&gt;]
<span class="k">member</span> <span class="i">x</span><span class="o">.</span><span class="i">Register</span>(<span class="i">representation</span> <span class="o">:</span> <span class="i">RegisterRepresentation</span>) <span class="o">=</span>
  <span class="k">let</span> <span class="i">confirmUrl</span> <span class="o">=</span> <span class="i">Uri</span>(<span class="i">x</span><span class="o">.</span><span class="i">Request</span><span class="o">.</span><span class="i">RequestUri</span>, <span class="s">&quot;</span><span class="s">/</span><span class="s">confirm</span><span class="s">.</span><span class="s">.</span><span class="s">.</span><span class="s">&quot;</span>)
  <span class="k">match</span> <span class="i">startProcess</span> <span class="i">representation</span> <span class="k">with</span>
    | <span class="i">Success</span> <span class="i">s</span> <span class="k">-&gt;</span> 
        <span class="k">match</span> <span class="i">s</span><span class="o">.</span><span class="i">Confirmation</span> <span class="k">with</span>
        | <span onmouseout="hideTip(event, 'fs3', 24)" onmouseover="showTip(event, 'fs3', 24)" class="i">Some</span> <span class="i">c</span> <span class="k">-&gt;</span> 
            <span class="k">match</span> <span class="i">c</span><span class="o">.</span><span class="i">Activation</span> <span class="k">with</span>
            | <span onmouseout="hideTip(event, 'fs3', 25)" onmouseover="showTip(event, 'fs3', 25)" class="i">Some</span> <span class="i">a</span> <span class="k">-&gt;</span> <span class="i">x</span><span class="o">.</span><span class="i">Created</span>(<span class="i">confirmUrl</span>,
                        { 
                            <span class="i">Email</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs11', 26)" onmouseover="showTip(event, 'fs11', 26)" class="i">fst</span> (<span class="i">getEmail</span> <span class="i">s</span>)
                            <span class="i">Code</span> <span class="o">=</span> <span class="i">a</span><span class="o">.</span><span class="i">ActivationCode</span> 
                        }) <span class="o">:&gt;</span> <span class="i">IHttpActionResult</span>
            | <span onmouseout="hideTip(event, 'fs6', 27)" onmouseover="showTip(event, 'fs6', 27)" class="i">None</span> <span class="k">-&gt;</span> <span class="i">x</span><span class="o">.</span><span class="i">Ok</span>() <span class="o">:&gt;</span> <span class="i">IHttpActionResult</span>
        | <span onmouseout="hideTip(event, 'fs6', 28)" onmouseover="showTip(event, 'fs6', 28)" class="i">None</span> <span class="k">-&gt;</span> <span class="i">x</span><span class="o">.</span><span class="i">Ok</span>() <span class="o">:&gt;</span> <span class="i">IHttpActionResult</span>
    | <span onmouseout="hideTip(event, 'fs1', 29)" onmouseover="showTip(event, 'fs1', 29)" class="i">Failure</span> <span class="i">f</span> <span class="k">-&gt;</span> 
        <span class="k">match</span> <span class="i">f</span> <span class="k">with</span>
        | <span class="i">ValidationError</span> <span class="i">ve</span> <span class="k">-&gt;</span> <span class="i">x</span><span class="o">.</span><span class="i">BadRequest</span>(<span class="i">x</span><span class="o">.</span><span class="i">ModelState</span>) 
                                <span class="o">:&gt;</span> <span class="i">IHttpActionResult</span>
        | <span class="i">AccountExists</span> _ <span class="k">-&gt;</span> <span class="i">x</span><span class="o">.</span><span class="i">Conflict</span>() <span class="o">:&gt;</span> <span class="i">IHttpActionResult</span>
        | <span class="i">DatabaseError</span> <span class="i">de</span> <span class="k">-&gt;</span> 
            <span class="i">x</span><span class="o">.</span><span class="i">InternalServerError</span>(<span class="i">Exception</span>(<span class="i">de</span>)) 
                                <span class="o">:&gt;</span> <span class="i">IHttpActionResult</span></pre>
</td>
</tr>
</table>

</section>

<section >

<h3>Handle it with computation expressions</h3>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
<span class="l">20: </span>
<span class="l">21: </span>
<span class="l">22: </span>
<span class="l">23: </span>
<span class="l">24: </span>
<span class="l">25: </span>
<span class="l">26: </span>
<span class="l">27: </span>
<span class="l">28: </span>
<span class="l">29: </span>
<span class="l">30: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
[&lt;<span class="i">HttpPost</span>&gt;]
[&lt;<span class="i">Route</span>(<span class="s">&quot;</span><span class="s">api</span><span class="s">/</span><span class="s">register</span><span class="s">&quot;</span>)&gt;]
<span class="k">member</span> <span class="i">x</span><span class="o">.</span><span class="i">Register2</span>(<span class="i">representation</span> <span class="o">:</span> <span class="i">RegisterRepresentation</span>) <span class="o">=</span>
   <span class="k">let</span> <span class="i">confirmUrl</span> <span class="o">=</span> <span class="i">Uri</span>(<span class="i">x</span><span class="o">.</span><span class="i">Request</span><span class="o">.</span><span class="i">RequestUri</span>, <span class="s">&quot;</span><span class="s">/</span><span class="s">confir</span><span class="s">.</span><span class="s">.</span><span class="s">.</span><span class="s">&quot;</span>)
   <span class="k">match</span> <span class="i">startProcess</span> <span class="i">representation</span> <span class="k">with</span>
    | <span class="i">Success</span> <span class="i">s</span> <span class="k">-&gt;</span> 
      <span class="k">let</span> <span class="i">rsp</span> <span class="o">=</span> 
        <span class="i">maybeRes</span>
        {
            <span class="k">let!</span> <span class="i">confirmation</span> <span class="o">=</span> <span class="i">s</span> <span class="o">|&gt;</span> (<span class="k">fun</span> <span class="i">a</span> <span class="k">-&gt;</span> <span class="i">a</span><span class="o">.</span><span class="i">Conf</span>) 
            <span class="k">let!</span> <span class="i">activation</span> <span class="o">=</span> <span class="i">confirmation</span> 
                                <span class="o">|&gt;</span> (<span class="k">fun</span> <span class="i">c</span> <span class="k">-&gt;</span> <span class="i">c</span><span class="o">.</span><span class="i">Acti</span>)
            <span class="k">let!</span> <span class="i">r</span> <span class="o">=</span> (<span class="i">s</span>, <span class="i">activation</span>) <span class="o">|&gt;</span> (<span class="k">fun</span> (<span class="i">ss</span>, <span class="i">a</span>) <span class="k">-&gt;</span> 
                    <span onmouseout="hideTip(event, 'fs3', 30)" onmouseover="showTip(event, 'fs3', 30)" class="i">Some</span> (<span class="i">getConf</span> (<span onmouseout="hideTip(event, 'fs11', 31)" onmouseover="showTip(event, 'fs11', 31)" class="i">fst</span> (<span class="i">getEmail</span> <span class="i">ss</span>)) <span class="i">a</span>))
            <span class="k">return</span> <span class="i">r</span>
        }
        <span class="k">match</span> <span class="i">rsp</span> <span class="k">with</span>
        | <span onmouseout="hideTip(event, 'fs3', 32)" onmouseover="showTip(event, 'fs3', 32)" class="i">Some</span> <span class="i">r</span> <span class="k">-&gt;</span> <span class="i">x</span><span class="o">.</span><span class="i">Created</span>(<span class="i">confirmUrl</span>, <span class="i">r</span>) 
                            <span class="o">:&gt;</span> <span class="i">IHttpActionResult</span>
        | <span onmouseout="hideTip(event, 'fs6', 33)" onmouseover="showTip(event, 'fs6', 33)" class="i">None</span> <span class="k">-&gt;</span> <span class="i">x</span><span class="o">.</span><span class="i">Ok</span>() <span class="o">:&gt;</span> <span class="i">IHttpActionResult</span>

    | <span onmouseout="hideTip(event, 'fs1', 34)" onmouseover="showTip(event, 'fs1', 34)" class="i">Failure</span> <span class="i">f</span> <span class="k">-&gt;</span> 
        <span class="k">match</span> <span class="i">f</span> <span class="k">with</span>
        | <span class="i">ValidationError</span> <span class="i">ve</span> <span class="k">-&gt;</span> <span class="i">x</span><span class="o">.</span><span class="i">BadRequest</span>(<span class="i">x</span><span class="o">.</span><span class="i">ModelState</span>) 
                                <span class="o">:&gt;</span> <span class="i">IHttpActionResult</span>
        | <span class="i">AccountExists</span> _ <span class="k">-&gt;</span> <span class="i">x</span><span class="o">.</span><span class="i">Conflict</span>() 
                                <span class="o">:&gt;</span> <span class="i">IHttpActionResult</span>
        | <span class="i">DatabaseError</span> <span class="i">de</span> <span class="k">-&gt;</span> 
                <span class="i">x</span><span class="o">.</span><span class="i">InternalServerError</span>(<span class="i">Exception</span>(<span class="i">de</span>)) 
                                <span class="o">:&gt;</span> <span class="i">IHttpActionResult</span></pre>
</td>
</tr>
</table>

</section>

<section >

<h3>Computation expression</h3>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
<span class="l">8: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">type</span> <span class="i">MaybeResBuilder</span>() <span class="o">=</span>

    <span class="k">member</span> <span class="i">this</span><span class="o">.</span><span class="i">Bind</span>(<span class="i">x</span>, <span class="i">f</span>) <span class="o">=</span> <span onmouseout="hideTip(event, 'fs12', 35)" onmouseover="showTip(event, 'fs12', 35)" class="i">Option</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs13', 36)" onmouseover="showTip(event, 'fs13', 36)" class="i">bind</span> <span class="i">f</span> <span class="i">x</span>            

    <span class="k">member</span> <span class="i">this</span><span class="o">.</span><span class="i">Return</span>(<span class="i">x</span>) <span class="o">=</span>
        <span onmouseout="hideTip(event, 'fs3', 37)" onmouseover="showTip(event, 'fs3', 37)" class="i">Some</span> <span class="i">x</span>

<span class="k">let</span> <span class="i">maybeRes</span> <span class="o">=</span> <span class="k">new</span> <span class="i">MaybeResBuilder</span>()</pre>
</td>
</tr>
</table>

</section>

</section>

<section >

<section >

<h3>Easy testing</h3>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
<span class="l">20: </span>
<span class="l">21: </span>
<span class="l">22: </span>
<span class="l">23: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
[&lt;<span class="i">Fact</span>&gt;]
<span class="k">let</span> <span class="i">``Post returns &#39;Ok&#39; on valid data and trusted provider``</span>() <span class="o">=</span>

    <span class="k">let</span> <span class="i">start</span> _ <span class="o">=</span> { <span class="i">Account</span><span class="o">.</span><span class="i">Email</span> <span class="o">=</span> <span class="s">&quot;</span><span class="s">test</span><span class="s">@</span><span class="s">email</span><span class="s">.</span><span class="s">fr</span><span class="s">&quot;</span> 
                        <span class="o">|&gt;</span> <span class="i">EmailAddress</span> 
                        <span class="o">|&gt;</span> <span class="i">VerifiedEmail</span> 
                        <span class="o">|&gt;</span> <span class="i">Verified</span>
                    <span class="i">Password</span> <span class="o">=</span> <span class="s">&quot;</span><span class="s">pass</span><span class="s">&quot;</span>
                    <span class="i">Provider</span> <span class="o">=</span> <span class="s">&quot;</span><span class="s">OAuth</span><span class="s">&quot;</span>
                    <span class="i">Confirmation</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs6', 38)" onmouseover="showTip(event, 'fs6', 38)" class="i">None</span>} <span class="o">|&gt;</span> <span class="i">Success</span>

    <span class="k">use</span> <span class="i">controller</span> <span class="o">=</span> <span class="k">new</span> <span class="i">RegisterController</span>(<span class="i">start</span>)
    <span class="i">controller</span><span class="o">.</span><span class="i">Request</span> <span class="o">&lt;-</span> <span class="k">new</span> <span class="i">HttpRequestMessage</span>(<span class="i">HttpMethod</span><span class="o">.</span><span class="i">Post</span>, 
                            <span class="s">&quot;</span><span class="s">http</span><span class="s">:</span><span class="s">/</span><span class="s">/</span><span class="s">localhost</span><span class="s">/</span><span class="s">api</span><span class="s">/</span><span class="s">register</span><span class="s">&quot;</span>)

    <span class="k">let</span> <span class="i">representation</span> <span class="o">=</span> {<span class="i">Email</span> <span class="o">=</span> <span class="s">&quot;</span><span class="s">test</span><span class="s">@</span><span class="s">email</span><span class="s">.</span><span class="s">fr</span><span class="s">&quot;</span>
                          <span class="i">Password</span> <span class="o">=</span><span class="s">&quot;</span><span class="s">pass</span><span class="s">&quot;</span>
                          <span class="i">Privacy</span> <span class="o">=</span> <span class="k">true</span>
                          <span class="i">Provider</span> <span class="o">=</span><span class="s">&quot;</span><span class="s">OAuth</span><span class="s">&quot;</span>}

    <span class="k">let</span> <span class="i">result</span> <span class="o">:</span> <span class="i">IHttpActionResult</span> <span class="o">=</span> <span class="i">controller</span><span class="o">.</span><span class="i">Register</span> <span class="i">representation</span>

    <span class="i">result</span> <span class="o">|&gt;</span> <span class="i">should</span> <span class="i">be</span> <span class="i">ofExactType</span><span class="o">&lt;</span><span class="i">Results</span><span class="o">.</span><span class="i">OkResult</span><span class="o">&gt;</span></pre>
</td>
</tr>
</table>

</section>

</section>

<section >

<section >

<h3>Immediate feedback</h3>

<p><img src="images/fsharpusecase.jpg" alt="alt text" title="F# use case" /></p>

</section>

<section >

<h3>Observations</h3>

<ul>
<li>Composition through functions</li>
<li>Functions are also values</li>
<li>No state mutation</li>
<li>Business use case function</li>
<li>Testable</li>
</ul>

</section>

<section >

<h3>F# implementation noises</h3>

<p>Lines of code: <strong>397</strong></p>

<ul>
<li>Correctness:       <strong>5%</strong> (-20%)</li>
<li>Expressiveness:    <strong>10%</strong> (-24%)</li>
<li>Frameworks:        <strong>28%</strong> (-14%)</li>
<li>Complexity:        <strong>N/A</strong></li>
<li>Organization:      <strong>Easy</strong></li>
<li>Readability:       <strong>Excellent</strong></li>
<li>Effort:            <strong>Low</strong>
<br />
<br />
CodeSNR = <strong>23%</strong> (+16%)</li>
</ul>

</section>

</section>

<section >

<section >

<h3>Code organisation</h3>

<p><img src="images/CSharpRefactoredProj.jpg" alt="alt text" title="Too many implementations and abstractions" />
<img src="images/FSharpProj.jpg" alt="alt text" title="Easy to understand organisation" /></p>

<aside class="notes">
What's nice about this approach is that, if you are a newcomer to a code base, you always know where to start. The first few files will always be the "bottom layer" of an application and the last few files will always be the "top layer". No folders needed!
</aside>

</section>

</section>

<section >

<section >

<h3>How we've improved the signal with F#</h3>

<ul>
<li>No need of frameworks for DI</li>
<li>No need of AOP frameworks</li>
<li>No need of ORM frameworks</li>
<li>No need to know 23 OOP patterns and more</li>
</ul>

<aside class="notes">
    DI : Partial application

<p>Dependencies can only happen when a specific type is referenced. If you use generic types, you cannot have a dependency! And rather than hard coding behavior for a type, why not parameterize it by passing in functions instead?</p>

<p>A more functional approach: separating types from functions</p>

<p>AOP: Higher level functions, monads level of abstractions to hide complexisty
</aside></p>

</section>

</section>

<section >

<section >

<h3>OOP</h3>

<blockquote>
  <p>"OOP promise REUSE = Big Lie" -- Rich Hickey</p>
</blockquote>

<aside class="notes">
    OOP promis REUSE = Big Lie (everything new you need you write a new class) Different classes with same name fields and we can do nothing because of specificity.
</aside>

</section>

</section>

<section >

<section >

<h3>Values</h3>

<ul>
<li>Shared freely, no one can mess up</li>
<li>No locks, copy, clone easy to fabricate (testing, simulation)</li>
<li>Discurage imperative programming</li>
<li>Generic (map, list, sets)</li>
<li>Best interface</li>
<li>Can be composed and aggregated</li>
</ul>

<aside class="notes">
    values can be moved, ported and the so (how do you do when you have to move between different interfaces ?)

<p>values aggregates values (COMPOSITION) how do you agregate places in OOP ?</p>

<p>you can't have a single view on a value with multiple getters (OOP) because you need the reicipe
</aside></p>

</section>

</section>

<section >

<section >

<h3>Let's create a REST service</h3>

<h4>Can turn bad easily with OOP...</h4>

<h5>when not very carfeully used...</h5>

</section>

</section>

<section >

<section >

<h3>Like many things in the real life after all</h3>

</section>

<section >

<h3>Let's saw this board</h3>

<p><img src="images/BadSaw.jpg" alt="alt text" title="Let's saw this board" /></p>

</section>

<section >

<h3>Let's install this air conditioner</h3>

<p><img src="images/BadAirCond.jpg" alt="alt text" title="Let's install this air conditioner" /></p>

</section>

<section >

<h3>Let's get this party started!</h3>

<p><img src="images/BadPoolMix.jpg" alt="alt text" title="Let's install this air conditioner" /></p>

</section>

<section >

<h3>And finally</h3>

<h4>Let's get some liquor and guns, but without leaving our vehicle</h4>

<p><img src="images/Badshoot.jpg" alt="alt text" title="Let's get some liquor and guns, but without leaving our vehicle" /></p>

</section>

<section >

<h3>Murphy's law</h3>

<blockquote>
  <p>Anything that can go wrong, will go wrong.</p>
</blockquote>

</section>

</section>

<section >

<section >

<h3>References</h3>

<ul>
<li><a href="http://fsharpforfunandprofit.com">http://fsharpforfunandprofit.com</a></li>
<li>MSDN</li>
</ul>

</section>

</section>



        </div>
    </div>
    <script src="lib/js/head.min.js"></script>
    <script src="js/reveal.min.js"></script>
    <script>

        // Full list of configuration options available here:
        // https://github.com/hakimel/reveal.js#configuration
        Reveal.initialize({
            controls: true,
            progress: true,
            history: true,
            center: true,

            theme: 'beige', // available themes are in /css/theme
            transition: 'default', // default/cube/page/concave/zoom/linear/fade/none

            // Parallax scrolling
            // parallaxBackgroundImage: 'https://s3.amazonaws.com/hakim-static/reveal-js/reveal-parallax-1.jpg',
            // parallaxBackgroundSize: '2100px 900px',

            // Optional libraries used to extend on reveal.js
            dependencies: [
                { src: 'lib/js/classList.js', condition: function () { return !document.body.classList; } },
                { src: 'plugin/markdown/marked.js', condition: function () { return !!document.querySelector('[data-markdown]'); } },
                { src: 'plugin/markdown/markdown.js', condition: function () { return !!document.querySelector('[data-markdown]'); } },
                { src: 'plugin/highlight/highlight.js', async: true, callback: function () { hljs.initHighlightingOnLoad(); } },
                { src: 'plugin/zoom-js/zoom.js', async: true, condition: function () { return !!document.body.classList; } },
                { src: 'plugin/notes/notes.js', async: true, condition: function () { return !!document.body.classList; } }
            ]
        });

    </script>
</body>
</html>

